<!DOCTYPE html>
<html>
<head>
    <title>Collect the Gems!</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P" rel="stylesheet">
    <style>
        body {
            font-family: "Press Start 2P", sans-serif;
        }
        #game-container {
            position: relative;
        }
        canvas {
        background: url(background.png);
        background-size: cover;
        }
        canvas, #counter, #game-start, #game-over {
        position: absolute;
        top: 0px;
        left: 0px;  
        }
        canvas, #game-start, #game-over {
        border: 1px solid gray;
        width: 854px;
        height: 480px;
        }
        #counter text {
            font-size: 130%;
            fill: white;
            stroke: black;
            stroke-width: 1px;
        }
        #game-start text {
            font-size: 150%;
            fill: white;
            text-anchor: middle;
        }
        #game-start #game-title {
            font-size: 400%;
            fill: url(#title-fill);
            stroke: black;
        }
        #game-over text {
            font-size: 120%;
            fill: url(#game-over-fill);
            text-anchor: middle;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="gameCanvas" width="854px" height="480px"></canvas>
        <svg xmlns="http://www.w3.org/2000/svg" id="game-start">
            <defs>
                <linearGradient id="title-fill" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0.2" stop-color="red" />
                    <stop offset="0.4" stop-color="yellow" />
                    <stop offset="0.6" stop-color="green" />
                    <stop offset="0.8" stop-color="purple" />
                </linearGradient>
            </defs>
            <text id="game-title" x="50%" y="45%">GEM RUSH!</text>
            <text x="50%" y="60%">Click here to start the game</text>
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" id="game-over" style="display: none">
            <defs>
                <linearGradient id="game-over-fill" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0" stop-color="red" />
                    <stop offset="0.5" stop-color="yellow" />
                    <stop offset="1" stop-color="red" />
                </linearGradient>
            </defs>
            <text x="50%" y="50%">
                Time's up! You have collected
                <tspan id="final-gems">0</tspan>
                gem(s).
            </text>
        </svg>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <script src="bounding_box.js"></script>
    <script src="sprite.js"></script>
    <script src="gem_player.js"></script>
    <script src="gem_gem.js"></script>
    <script src="gem_fire.js"></script>
    <script>
    $(function() {
        const canvas = document.getElementById("gameCanvas");
        const context = canvas.getContext("2d");
        const socket = new WebSocket("ws://localhost:8000");
        const gameArea = BoundingBox(context, 165, 60, 420, 800);
        let players = {};
        let gems = [];
        const cornerPoints = gameArea.getPoints();
        let fires = [
            Fire(context, cornerPoints.topLeft[0], cornerPoints.topLeft[1], "realfire"),
            Fire(context, cornerPoints.topRight[0], cornerPoints.topRight[1], "realfire"), 
            Fire(context, cornerPoints.bottomLeft[0], cornerPoints.bottomLeft[1], "realfire"), 
            Fire(context, cornerPoints.bottomRight[0], cornerPoints.bottomRight[1], "realfire"), 
            ]
        let collectedGems = 0;

        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            players = data.players;
            gems = data.gems;
            fires = data.fires;
            drawGame();
        };

        function drawGame() {
            context.clearRect(0, 0, canvas.width, canvas.height);
            for (const id in players) {
                const player = players[id];
                context.fillStyle = "blue"; // Player color
                context.fillRect(player.x, player.y, 20, 20); // Draw player sprite
                context.fillText(`Gems: ${player.gems}`, player.x - 10, player.y - 10); // Display collected gems
            }
            gems.forEach(gem => {
                if (!gem.collected) {
                    context.fillStyle = "green";
                    context.fillRect(gem.x, gem.y, 15, 15); // Draw gem
                }
            });
            fires.forEach(f => f.draw());
        }


        $("#game-start").on("click", function() {
            $("#game-start").hide();
            // Start game logic
            $(document).on("keydown", function(event) {
            let dx = 0, dy = 0;
            switch (event.keyCode) {
                case 37: dx = -5; break; // left arrow
                case 38: dy = -5; break; // up arrow
                case 39: dx = 5; break;  // right arrow
                case 40: dy = 5; break;  // down arrow
            }
            socket.send(JSON.stringify({ type: 'move', dx, dy }));
        });
        });
    });
    </script>
</body>
</html>
